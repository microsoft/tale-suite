description: Text Games Benchmark

environment:
  image: azureml/azureml_b48beba85ea5ab1bbaa48abeeab0bb21:latest
  username: modularpolicies
  registry: modularpolicies.azurecr.io
  setup:
    - pip install -r requirements.txt
    - sudo apt-get update && sudo apt-get install -y netcat
    - ~/.local/bin/llm install plugins/gcr_llama
    - ~/.local/bin/llm logs path
    - cp -v config/extra-openai-models.yaml ~/.config/io.datasette.llm/
    - ~/.local/bin/llm models
    - python -m vllm.entrypoints.openai.api_server --model microsoft/phi-2 --host 0.0.0.0 &
    - |
      # Wait for the vllm server to be up
      while ! nc -z localhost 8000; do
        sleep 1
      done
      echo "vllm server is up and running"
    - ~/.local/bin/llm -m llama "What's up?"

code:
  # local directory of the code. this will be uploaded to the server.
  # $CONFIG_DIR is expanded to the directory of this config file
  local_dir: $CONFIG_DIR/../

# list of jobs to run
jobs:
- name: Text Games Benchmark
  sku: G1
  identity: managed
  submit_args:
    env:
      _AZUREML_SINGULARITY_JOB_UAI: /subscriptions/693ffe34-785e-44cd-8fb7-81da25f4d3bd/resourcegroups/ModularPolicies/providers/Microsoft.ManagedIdentity/userAssignedIdentities/modularpoliciesmi
  command:
  - python benchmark.py --agent agent_llm.py:LLMAgent --llm llama -vv --context 100 --admissible_commands
